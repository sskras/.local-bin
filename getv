#! /usr/bin/env sh

# SPDX-License-Identifier: BlueOak-1.0.0
# SPDX-FileCopyrightText: 2025 Saulius Krasuckas <saulius2_at_ar-fi_point_lt> | sskras

# Get videos from the internet.

Channel=${1:-lrt}
Start_time=${2:-now}
Duration=${3:-60m}
TRACKS="hls-audio1-ORG+hls-audio1-LIT"
OUTPUT="%(title)s [%(id)s]-audio.%(ext)s"
Curr_date=$(date +%Y-%m-%d)

case $Channel in

  (lrt)
    Url="https://www.lrt.lt/mediateka/tiesiogiai/lrt-televizija"
    ;;

  (lrt+)
    Url="https://www.lrt.lt/mediateka/tiesiogiai/lrt-plius"
    ;;

  (*)
    Url="TODO://unknown-channel"
    ;;
esac

Log=${4:-[YEAR]-ORIG-(ENG;-LITH)-FHD.${Curr_date}-LRT}audio.log

Cmd="
cd
at '${Start_time}' << \
-----------------------------
(
  date
  pwd
  timeout -s SIGINT         \
    ${Duration}             \
    yt-dlp                  \
      --audio-multistreams  \
      -f '${TRACKS}'        \
      -o '${OUTPUT}'        \
      ${Url}                \

) \
> '${Log}' 2>&1
-----------------------------
"
eval "$Cmd"

echo "Using some defaults:"
echo "$Cmd"
echo "$Cmd" | awk '/----|^$/ { next } { sub(/^ +/, ""); gsub(/ +/, " "); EOL=" "; if (!match($0, /[()]$/)) EOL="; "; if (match($0, /\(|https|>&1$/)) EOL="\n"; printf("%s%s", $0, EOL) } END { print "" }'
