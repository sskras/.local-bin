#! /usr/bin/env sh

# SPDX-License-Identifier: BlueOak-1.0.0
# SPDX-FileCopyrightText: 2025 Saulius Krasuckas <saulius2_at_ar-fi_point_lt> | sskras

# Get videos from the internet.

Channel=${1:-lrt}
Start_time=${1:-now}
Duration=${3:-60m}
URL="https://www.lrt.lt/mediateka/tiesiogiai/lrt-televizija"
TRACKS="hls-audio1-ORG+hls-audio1-LIT+hls-3"
OUTPUT="%(title)s [%(id)s].%(ext)s"
LOG="[2018]-The-Favourite-(FavoritÄ—)-FHD.2025-04-04-LRT.log"

Cmd="
cd
at '${Start_time}' << \
-----------------------------
(
  date
  pwd
  timeout -s SIGINT         \
    ${Duration}             \
    yt-dlp                  \
      --audio-multistreams  \
      -f '${TRACKS}'        \
      -o '${OUTPUT}'        \
      ${URL}                \

) \
> '${LOG}' 2>&1
-----------------------------
"
eval "$Cmd"

echo "Using some defaults:"
echo "$Cmd"
echo "$Cmd" | awk '/----|^$/ { next } { sub(/^ +/, ""); gsub(/ +/, " "); EOL=" "; if (!match($0, /[()]$/)) EOL="; "; if (match($0, /\(|https|>&1$/)) EOL="\n"; printf("%s%s", $0, EOL) } END { print "" }'
